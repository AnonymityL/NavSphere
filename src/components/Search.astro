---
/**
 * æœç´¢ç»„ä»¶ - å®¢æˆ·ç«¯äº¤äº’
 */
---

<div class="search-container mb-8">
  <div class="relative">
    <input
      type="text"
      id="search-input"
      placeholder="æœç´¢å¯¼èˆªé¡¹..."
      class="w-full px-4 py-3 pl-12 text-lg border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-shadow"
      autocomplete="off"
    />

    <!-- æœç´¢å›¾æ ‡ -->
    <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 text-xl">ğŸ”</span>

    <!-- æ¸…é™¤æŒ‰é’® -->
    <button
      id="clear-button"
      class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 hidden"
      aria-label="æ¸…é™¤æœç´¢"
    >
      <span class="text-xl">âœ•</span>
    </button>
  </div>

  <!-- æœç´¢ç»“æœç»Ÿè®¡ -->
  <div id="search-stats" class="mt-2 text-sm text-gray-500 hidden">
    æ‰¾åˆ° <span id="result-count" class="font-semibold">0</span> ä¸ªç»“æœ
  </div>
</div>

<script>
  let searchTimeout = null;

  function search(query) {
    // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
    if (searchTimeout) {
      clearTimeout(searchTimeout);
    }

    // é˜²æŠ– 300ms
    searchTimeout = setTimeout(() => {
      const searchTerm = query.toLowerCase().trim();

      // è·å–æ‰€æœ‰åˆ†ç±»å—
      const categoryBlocks = document.querySelectorAll('section');
      const totalItems = document.querySelectorAll('[data-searchable]').length;
      let visibleItems = 0;

      categoryBlocks.forEach((block) => {
        const items = block.querySelectorAll('[data-searchable]');
        let hasVisibleItems = false;

        items.forEach((item) => {
          const text = item.dataset.searchable?.toLowerCase() || '';
          const matches = text.includes(searchTerm);

          if (searchTerm === '' || matches) {
            item.style.display = '';
            hasVisibleItems = true;
            if (searchTerm !== '') {
              visibleItems++;
            }
          } else {
            item.style.display = 'none';
          }
        });

        // æ˜¾ç¤º/éšè—æ•´ä¸ªåˆ†ç±»å—
        if (searchTerm === '') {
          block.style.display = '';
        } else if (hasVisibleItems) {
          block.style.display = '';
        } else {
          block.style.display = 'none';
        }
      });

      // æ›´æ–°æœç´¢ç»Ÿè®¡
      const searchStats = document.getElementById('search-stats');
      const resultCount = document.getElementById('result-count');

      if (searchTerm !== '') {
        searchStats?.classList.remove('hidden');
        if (resultCount) {
          resultCount.textContent = visibleItems.toString();
        }
      } else {
        searchStats?.classList.add('hidden');
      }

      // æ˜¾ç¤º/éšè—æ¸…é™¤æŒ‰é’®
      const clearButton = document.getElementById('clear-button');
      if (clearButton) {
        if (searchTerm !== '') {
          clearButton.classList.remove('hidden');
        } else {
          clearButton.classList.add('hidden');
        }
      }
    }, 300);
  }

  // ç›‘å¬æœç´¢è¾“å…¥
  const searchInput = document.getElementById('search-input');
  if (searchInput) {
    searchInput.addEventListener('input', (e) => {
      search(e.target.value);
    });

    // æ”¯æŒ Enter é”®è§¦å‘æœç´¢
    searchInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        search(searchInput.value);
      }
    });
  }

  // æ¸…é™¤æŒ‰é’®
  const clearButton = document.getElementById('clear-button');
  if (clearButton) {
    clearButton.addEventListener('click', () => {
      if (searchInput) {
        searchInput.value = '';
        search('');
        searchInput.focus();
      }
    });
  }

  // æ”¯æŒ / å¿«æ·é”®èšç„¦æœç´¢æ¡†
  document.addEventListener('keydown', (e) => {
    if (e.key === '/' && document.activeElement !== searchInput) {
      e.preventDefault();
      searchInput?.focus();
    }
  });
</script>

<style>
  #search-input:focus {
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }
</style>
